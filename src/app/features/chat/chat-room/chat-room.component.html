<div class="chat-container" *ngIf="activeRoom">
  <!-- Chat Header -->
  <div class="chat-header">
    <div class="room-info">
      <h2>{{ activeRoom.name }}</h2>
      <div class="room-meta">
        <span class="online-count" *ngIf="onlineUsers.length > 0">
          {{ onlineUsers.length }} {{ onlineUsers.length === 1 ? 'person' : 'people' }} online
        </span>
        <span class="typing-indicator" *ngIf="getTypingUsers().length > 0">
          {{ getTypingIndicatorText(getTypingUsers()) }}
        </span>
      </div>
    </div>
  </div>

  <!-- Messages Container -->
  <div class="messages-container" #messagesContainer>
    <div class="messages" *ngIf="!loading; else loadingTemplate">
      <ng-container *ngFor="let message of messages; trackBy: trackByMessageId">
        <div class="message" [class.sent]="message.senderId === currentUser.id">
          <div class="message-avatar" *ngIf="message.senderId !== currentUser.id">
            <app-user-avatar 
              [user]="getUser(message.senderId)" 
              [size]="'medium'"
              [showName]="false">
            </app-user-avatar>
          </div>
          <div class="message-content">
            <div class="message-header">
              <span class="sender">{{ getUsername(message.senderId) }}</span>
              <span class="timestamp">{{ message.timestamp | date:'shortTime' }}</span>
            </div>
            <div class="message-text">{{ message.content }}</div>
          </div>
        </div>
      </ng-container>
    </div>
    
    <ng-template #loadingTemplate>
      <div class="loading-messages">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading messages...</p>
      </div>
    </ng-template>
  </div>
  
  <!-- Message Input -->
  <div class="message-input-container">
    <form (submit)="sendMessage(); $event.preventDefault()" class="message-form">
      <div class="typing-indicator" *ngIf="getTypingUsers().length > 0">
        <div class="typing-dots">
          <span></span>
          <span></span>
        </div>
        <span class="typing-text">{{ getTypingIndicatorText(getTypingUsers()) }}</span>
      </div>
      <div class="message-input-wrapper">
        <mat-form-field appearance="outline" class="message-input-field">
          <mat-label>Type a message...</mat-label>
          <input 
            matInput
            [(ngModel)]="messageText" 
            (input)="onMessageInput($event)"
            (keydown.enter)="sendMessage()"
            [disabled]="!activeRoom"
            name="message"
            #messageInput>
          <button 
            mat-icon-button 
            matSuffix
            type="submit" 
            [disabled]="!messageText || !activeRoom"
            color="primary"
            class="send-button">
            <mat-icon>send</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </form>
  </div>
</div>

<!-- No Room Selected -->
<div class="no-room" *ngIf="!activeRoom">
  <div class="no-room-content">
    <mat-icon class="no-room-icon">forum</mat-icon>
    <h2>Select a chat to start messaging</h2>
    <p>Choose an existing conversation or start a new one</p>
    <button 
      *ngIf="showNewChatButton" 
      (click)="startNewChat()"  
      class="new-chat-button"
    >
      New Chat
    </button>
  </div>
</div>
